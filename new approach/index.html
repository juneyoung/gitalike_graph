<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'>
	<title>Git alike graph</title>
</head>
<body>
	<div id ='test' style='width:100%; height:auto;'>
	</div>
</body>
</html>
<script>
	//기본 구조는 svg 안에 svg가 있음
	//최상위 svg는 그냥 전체 영역을 잡는 역할만 하고 
	//차상위 svg에 실제 calendar 가 들어가게 됨

	//차상위 svg 안에는 월별 svg 가 있음.
	//월별 svg 안에는 백그라운드 전체를 감싸는 rect, 
	//사각형이 들어가는 svg
	//월을 표기하는 text 태그가 있음 

	//사각형이 들어가는 svg
	//각 사각형은 g 태그 안에 rect 의 형식으로 존재하며
	//요소로 클래스 너비 높이 x좌표, y좌표를 가진다
	//클래스의 예시는 graph-rect r1 r0 q1 q0 hover_cursor

	const rectWidth = 15;
	const rectHeight = 15;
	const xPadPercentage = .2;
	const yPadPercentage = .2;
	var rectPaddingX = 0;
	var rectPaddingY = 0;
	var startX = 0;
	const rectClassName = 'graph-rect';
	const strokeColor = '#FFFFFF';
	const rectDefaultColor = '#ededed';
	const NAMESPACE = 'http://www.w3.org/2000/svg';

	window.addEventListener('load', function(){
		drawGraph('test');	
	}, false);

	function drawGraph(divId){
		var bg = document.getElementById(divId);

		rectPaddingX = rectWidth * xPadPercentage;
		rectPaddingY = rectHeight * yPadPercentage;

		var outer_svg = createVectorElement('svg');
		var inner_svg = createVectorElement('svg');

		outer_svg.id = 'outer_svg';
		inner_svg.id = 'inner_svg';

		addOuterStyle(outer_svg);
		addMonthRect(new Date(), inner_svg);
		outer_svg.appendChild(inner_svg);
		bg.appendChild(outer_svg);
	}

	function addOuterStyle (outer) {
		outer.width = window.innerWidth;
		outer.height = 600;

		outer.setAttribute('height', 200);
		outer.setAttribute('width', window.innerWidth);
	}

	function addInnerStyle (inner) {

	}


	function addMonthRect(date, monthGroupSvg){
		var dateMapObj = calcDays();
		console.log(dateMapObj);
 
		//하나만 찍어보기 
		var month_svg = createVectorElement('svg');
		month_svg.setAttribute('x', 0);
		console.log(dateMapObj['201412']);
		drawSingleDateGrid(dateMapObj['201412'], month_svg);
		monthGroupSvg.appendChild(month_svg);

		/*
		var i = 0;
		for(var singleMonth in dateMapObj){
			var month_svg = createVectorElement('svg');
			month_svg.setAttribute('x', i * (rectPaddingX + rectWidth) * 6);
			drawSingleDateGrid(dateMapObj[singleMonth], month_svg);
			monthGroupSvg.appendChild(month_svg);
			i++;
		}
		*/
	}


	function drawSingleDateGrid(singleMonth, bgSvg){
		var weeksPerMonth = Math.ceil(singleMonth.days/7);
		//var weeksPerMonth = 5;
		var totalCnt = 0;
		//console.log(weeksPerMonth);
		for(var i = 0; i < weeksPerMonth; i++) {
			for(var j = 0; j < 7; j++) {
				
				if(i == 0){
					if(singleMonth.st_day > j) continue;
				}else if(i == weeksPerMonth - 1 ) {
					//since it starts with 0, plus 1
					if(totalCnt > singleMonth.days - 1) continue;
				}

				var grid = createVectorElement('g');;
				var rect = createVectorElement('rect');

				rect.setAttribute('width', rectWidth);
				rect.setAttribute('height', rectHeight);

				//x 와 y 의 위치 px
				rect.setAttribute('x', i * (rectWidth + rectPaddingX));
				rect.setAttribute('y', j * (rectHeight + rectPaddingY));
				rect.style.fill = rectDefaultColor;
				//rect.className = rectClassName;

				rect.addEventListener('mouseover', function(){
					this.style.stroke = strokeColor;
				}, false);

				rect.addEventListener('mouseout', function(){
					this.style.stroke = '';
				}, false)

				grid.appendChild(rect);
				bgSvg.appendChild(grid);
				console.log('coordinates : ', i, ', ', j);
				totalCnt++;
			}
		}
	}



	function createVectorElement(tag){
		return document.createElementNS(NAMESPACE, tag);
	}

	//날짜

	function calcDays(){
		// {'201511' : {days: 30, st_day : 'MON'}, ...}
		var ret = {};
		var today = new Date();
		for(var i = 12; i >= 0; i--){
			var objDate = new Date();
			objDate.setMonth(today.getMonth() - i);
			var lastDay = new Date(objDate.getFullYear(), objDate.getMonth() + 1, 0);
			var firstDay = new Date(objDate.getFullYear(), objDate.getMonth(), 1);

			//console.log(firstDay, ' ~~ ', lastDay);
			var key = getFormatMonth(objDate);
			ret[key] = {};
			ret[key]['days'] = lastDay.getDate();
			ret[key]['st_day'] = firstDay.getDay();
		}
		return ret;
	}

	function countDaysPerMonth(dateObj){
		var obj = {daysArr: [], totalDays : 0};
		var startCountDate = dateObj.startDate;
		for(var i = 0; i < 12; i++){
			var targetDate = new Date();
			targetDate.setMonth(startCountDate.getMonth() - i);
			var year = targetDate.getFullYear();
			var month = targetDate.getMonth();

			var days = new Date(year, month, 0).getDate();
			obj.daysArr.push(days);
			obj.totalDays += days;
		}
		return obj;
	}

	function getStdDates(){
		var ret = {startDate : '', endDate : ''};
		ret.endDate = new Date();
		ret.startDate = new Date();
		ret.startDate.setFullYear(ret.endDate.getFullYear() - 1);
		return ret;
	}

	function getFormatMonth(date){
		var yyyy = date.getFullYear().toString();
		var mm = (date.getMonth()+1).toString();
		return yyyy + (mm[1]?mm:"0"+mm[0]);
	}

	function getFormatDate(date){
		var yyyy = date.getFullYear().toString();
		var mm = (date.getMonth() + 1).toString(); // getMonth() is zero-based
		var dd  = date.getDate().toString();
		return yyyy + (mm[1]?mm:"0"+mm[0]) + (dd[1]?dd:"0"+dd[0]); // padding
	}

</script>